# RF Listener

Этот проект демонстрирует минимальный стек для обмена данными между ПК и внешними устройствами по последовательному порту.

## Структура каталога

- `Lib/jSerialComm-2.11.2.jar` – сторонняя библиотека для работы с COM-портом: открытие, настройка и события.
- `src/RF` – исходники на Java.
  - `Main.java` – точка входа. Запускает графический интерфейс `MainUI`.
  - `MainUI.java` – Swing-интерфейс: позволяет выбрать параметры подключения (порт, скорость, битность, четность, стоп-биты) и вызывать функции класса `Inverters` через кнопку «Выполнить».
  - `cMAC.java` – «мини-MAC-слой», отвечающий за настройку и управление COM-портом, формирование/отправку пакетов и маршрутизацию входящих данных обработчикам верхнего уровня.
  - `ARP.java` – простейший протокол обнаружения устройств: отвечает на запросы MAC-адреса и `PING`, ведет таблицу посещений.
  - `Inverters.java` – набор команд к удаленным инверторам: `SetParameter`, `GetParameter`, `BlinkLedStart/Stop` и др.
  - `Address.java`, `PacketHandler.java` – вспомогательные классы для работы с адресами и пакетов.
- `bin/RF` – (опционально) каталог для скомпилированных классов.

## Основной функционал

1. **Формирование и отправка пакетов**
   - `cMAC.sendPacket` создает пакет структуры `| 4 байта адрес получателя | 4 байта адрес отправителя | полезная нагрузка |`.
   - Пакеты попадают в очередь `sendQueue`; поток `run()` отправляет их в COM-порт.

2. **Прием и маршрутизация**
   - `serialEvent` читает данные из порта и передает их в `handlePacket`.
   - По первому байту полезной нагрузки определяется тип пакета и вызывается соответствующий обработчик (`PacketHandler`).

3. **ARP**
   - Обрабатывает запросы MAC-адреса и `PING`, поддерживает таблицу «живых» устройств.

4. **Команды инверторов**
   - Реализуют схему «запрос‑ожидание»: каждый запрос создает `CompletableFuture`, который завершается при получении ответа или по таймауту.

5. **Графический интерфейс**
   - Позволяет выбрать доступный в системе COM-порт (список формируется методом `cMAC.getAvailablePorts`), настроить параметры соединения и вызвать одну из функций `Inverters`.

## Сборка и запуск

```bash
javac -d bin -cp Lib/jSerialComm-2.11.2.jar src/RF/*.java
java -cp Lib/jSerialComm-2.11.2.jar:bin RF.Main
```

Если при компиляции появляется сообщение `error: release version 23 not supported`,
значит установленная версия JDK не поддерживает целевую платформу 23. В таком
случае уберите параметр `--release 23` из команды компиляции или обновите JDK до
поддерживаемой версии.

> В средах без графической подсистемы (headless) запуск GUI приведет к ошибке `HeadlessException`.

